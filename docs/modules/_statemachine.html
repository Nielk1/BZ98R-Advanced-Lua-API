<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>ldoc</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
<li><a href="#StateMachineIter___Core">StateMachineIter - Core </a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/ScriptUtils.html">ScriptUtils</a></li>
  <li><a href="../modules/_api.html">_api</a></li>
  <li><a href="../modules/_config.html">_config</a></li>
  <li><a href="../modules/_gameobject.html">_gameobject</a></li>
  <li><a href="../modules/_hook.html">_hook</a></li>
  <li><a href="../modules/_navmanager.html">_navmanager</a></li>
  <li><a href="../modules/_printfix.html">_printfix</a></li>
  <li><a href="../modules/_requirefix.html">_requirefix</a></li>
  <li><strong>_statemachine</strong></li>
  <li><a href="../modules/_stateset.html">_stateset</a></li>
  <li><a href="../modules/_table_show.html">_table_show</a></li>
  <li><a href="../modules/_unsaved.html">_unsaved</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>_statemachine</code></h1>
<p>BZ98R LUA Extended API StateMachineIter.</p>
<p>

 State Machine and State Machine Iterator for serial event sequences across game turns.

 Dependencies: <a href="../modules/_api.html#">_api</a>, <a href="../modules/_hook.html#">_hook</a></p>
    <h3>Usage:</h3>
    <ul>
        <pre class="example">local statemachine = require(&quot;_statemachine&quot;);

statemachine.Create(&quot;TestMachine&quot;,
{
    [&quot;state_a&quot;] = function(state)
        print(&quot;test &quot; .. state.test1);
        state:switch(&quot;state_b&quot;);
    end,
    [&quot;state_b&quot;] = statemachine.SleepSeconds(10,&quot;state_c&quot;),
    [&quot;state_c&quot;] = function(state)
        print(&quot;test &quot; .. state.test2);
        state:switch(&quot;state_d&quot;);
    end,
    [&quot;state_d&quot;] = statemachine.SleepSeconds(15,&quot;state_e&quot;),
    [&quot;state_e&quot;] = function(state)
        print(&quot;test &quot; .. state.test3);
        state:switch(&quot;state_f&quot;);
    end
});

-- ordered state machine that supports state:next()
statemachine.Create(&quot;OrderedTestMachine&quot;,
{
    -- named state function
    { &quot;state_a&quot;, function(state)
        print(&quot;test &quot; .. state.test1);
        state:switch(&quot;state_b&quot;);
    end },

    -- named magic state function (SleepSeconds)
    -- note nil next_state means next state by index
    { &quot;state_b&quot;, statemachine.SleepSeconds(10) },

    -- named state function with automatic name
    { nil, function(state)
        print(&quot;test &quot; .. state.test2);
        state:switch(&quot;state_d&quot;);
    end },

    -- named state function with automatic name
    { function(state)
        print(&quot;test &quot; .. state.test2);
        state:switch(&quot;state_d&quot;);
    end },

    -- magic state function (SleepSeconds)
    statemachine.SleepSeconds(15,&quot;nonexistent_state&quot;),

    -- stsate function with automatic name
    function(state)
        print(&quot;test &quot; .. state.test3);
        state:next();
    end
});

hook.Add(&quot;InitialSetup&quot;, &quot;Custom_InitialSetup&quot;, function(turn)
    MissionData.TestSMI1 = statemachine.Start(&quot;TestMachine&quot;,&quot;state_a&quot;,{test1=&apos;d&apos;,test2=&quot;e&quot;,test3=&quot;f&quot;});
    MissionData.TestSMI2 = statemachine.Start(&quot;OrderedTestMachine&quot;,&quot;state_a&quot;,{test1=&apos;d&apos;,test2=&quot;e&quot;,test3=&quot;f&quot;});
end);

hook.Add(&quot;Update&quot;, &quot;Custom_Update&quot;, function(turn)
    MissionData.TestSMI1:run();
    MissionData.TestSMI2:run();
end);
</pre>
    </ul>
    <h3>Info:</h3>
    <ul>
        <li><strong>Author</strong>: John "Nielk1" Klein</li>
    </ul>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#isstatemachineiter">isstatemachineiter (object)</a></td>
	<td class="summary">Is this object an instance of StateMachineIter?</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.run">StateMachineIter.run (self)</a></td>
	<td class="summary">Run StateMachineIter.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.next">StateMachineIter.next (self)</a></td>
	<td class="summary">Next StateMachineIter State.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.switch">StateMachineIter.switch (self, key)</a></td>
	<td class="summary">Switch StateMachineIter State.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Create">Create (name, ...)</a></td>
	<td class="summary">Creates an StateMachineIter Template with the given indentifier.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Start">Start (name, state_key, init)</a></td>
	<td class="summary">Starts an StateMachineIter based on the StateMachineIter Template with the given indentifier.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SleepCalls">SleepCalls (calls, next_state[, early_exit])</a></td>
	<td class="summary">Wait a set period of time on this state.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.SecondsHavePassed">StateMachineIter.SecondsHavePassed (self[, seconds])</a></td>
	<td class="summary">Check if a set period of time has passed.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#SleepSeconds">SleepSeconds (seconds, next_state[, early_exit])</a></td>
	<td class="summary">Wait a set period of time on this state.</td>
	</tr>
</table>
<h2><a href="#StateMachineIter___Core">StateMachineIter - Core </a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.Save">StateMachineIter.Save (self)</a></td>
	<td class="summary">Save event function.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.Load">StateMachineIter.Load (data)</a></td>
	<td class="summary">Load event function.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#StateMachineIter.BulkLoad">StateMachineIter.BulkLoad ()</a></td>
	<td class="summary">BulkLoad event function.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "isstatemachineiter"></a>
    <strong>isstatemachineiter (object)</strong>
    </dt>
    <dd>
    Is this object an instance of StateMachineIter?


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">object</span>
         Object in question
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>

    </ol>




</dd>
    <dt>
    <a name = "StateMachineIter.run"></a>
    <strong>StateMachineIter.run (self)</strong>
    </dt>
    <dd>
    Run StateMachineIter.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
            <span class="types"><span class="type">StateMachineIter</span></span>
         FuncArrayIter instance
        </li>
    </ul>





</dd>
    <dt>
    <a name = "StateMachineIter.next"></a>
    <strong>StateMachineIter.next (self)</strong>
    </dt>
    <dd>
    Next StateMachineIter State.
 This only works if the StateMachineIter is ordered.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
            <span class="types"><span class="type">StateMachineIter</span></span>
         StateMachineIter instance
        </li>
    </ul>





</dd>
    <dt>
    <a name = "StateMachineIter.switch"></a>
    <strong>StateMachineIter.switch (self, key)</strong>
    </dt>
    <dd>
    Switch StateMachineIter State.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
            <span class="types"><span class="type">StateMachineIter</span></span>
         StateMachineIter instance
        </li>
        <li><span class="parameter">key</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         State to switch to (will also accept state index if the StateMachineIter is ordered)
        </li>
    </ul>





</dd>
    <dt>
    <a name = "Create"></a>
    <strong>Create (name, ...)</strong>
    </dt>
    <dd>
    Creates an StateMachineIter Template with the given indentifier.
 State descriptors are tables with the first element being the state name and the second element being the state function.
 If the second element is nil, the first element is considered the state function and the state name is generated automatically.
 If the state descriptor is instead a function it is treated as a nil state and the state name is generated automatically.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">name</span>
         Name of the StateMachineIter Template (string)
        </li>
        <li><span class="parameter">...</span>
         State descriptor and/or state descriptor collections, can be a table of named state functions or an array of state descriptors.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "Start"></a>
    <strong>Start (name, state_key, init)</strong>
    </dt>
    <dd>
    Starts an StateMachineIter based on the StateMachineIter Template with the given indentifier.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">name</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Name of the StateMachineIter Template
        </li>
        <li><span class="parameter">state_key</span>
         Initial state, if nil the first state will be used if the StateMachineIter is ordered, can be an integer is the StateMachineIter is ordered
        </li>
        <li><span class="parameter">init</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
         Initial data
        </li>
    </ul>





</dd>
    <dt>
    <a name = "SleepCalls"></a>
    <strong>SleepCalls (calls, next_state[, early_exit])</strong>
    </dt>
    <dd>
    Wait a set period of time on this state.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">calls</span>
            <span class="types"><span class="type">int</span></span>
         How many calls to wait
        </li>
        <li><span class="parameter">next_state</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Next state when timer hits zero
        </li>
        <li><span class="parameter">early_exit</span>
            <span class="types"><span class="type">function</span></span>
         Function to check if the state should be exited early, return false, true, or next state name
         (<em>optional</em>)
        </li>
    </ul>





</dd>
    <dt>
    <a name = "StateMachineIter.SecondsHavePassed"></a>
    <strong>StateMachineIter.SecondsHavePassed (self[, seconds])</strong>
    </dt>
    <dd>
    Check if a set period of time has passed.
 This first time this is called the target time is latched in until true is returned.
 Ensure you call state:SecondsHavePassed() or state:SecondsHavePassed(nil) to clear the timer if it did not return true and you need to move on.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
            <span class="types"><span class="type">StateMachineIter</span></span>
         StateMachineIter instance
        </li>
        <li><span class="parameter">seconds</span>
            <span class="types"><span class="type">number</span></span>
         How many seconds to wait
         (<em>optional</em>)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        True if the time is up
    </ol>




</dd>
    <dt>
    <a name = "SleepSeconds"></a>
    <strong>SleepSeconds (seconds, next_state[, early_exit])</strong>
    </dt>
    <dd>
    Wait a set period of time on this state.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">seconds</span>
            <span class="types"><span class="type">number</span></span>
         How many seconds to wait
        </li>
        <li><span class="parameter">next_state</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         Next state when timer hits zero
        </li>
        <li><span class="parameter">early_exit</span>
            <span class="types"><span class="type">function</span></span>
         Function to check if the state should be exited early, return false, true, or next state name
         (<em>optional</em>)
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header "><a name="StateMachineIter___Core"></a>StateMachineIter - Core </h2>

    <dl class="function">
    <dt>
    <a name = "StateMachineIter.Save"></a>
    <strong>StateMachineIter.Save (self)</strong>
    </dt>
    <dd>
    Save event function.
<p> INTERNAL USE.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
         StateMachineIter instance
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        ...
    </ol>




</dd>
    <dt>
    <a name = "StateMachineIter.Load"></a>
    <strong>StateMachineIter.Load (data)</strong>
    </dt>
    <dd>
    Load event function.
<p> INTERNAL USE.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">data</span>

        </li>
    </ul>





</dd>
    <dt>
    <a name = "StateMachineIter.BulkLoad"></a>
    <strong>StateMachineIter.BulkLoad ()</strong>
    </dt>
    <dd>
    BulkLoad event function.
<p> INTERNAL USE.







</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2025-05-06 08:48:55 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
